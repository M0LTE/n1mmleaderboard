@page
@model IndexModel
@{
    ViewData["Title"] = "Leaderboard";
}

<div class="row">
    <div class="col-md-12">
        <span id="lastUpdate" style="color:yellow; font-size:20pt; font-weight:bold;"></span>
        <table id="leaderboard" class="table embiggen">
            <thead>
                <tr>
                    <th scope="col">Op</th>
                    <th scope="col" id="measureTitle"></th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <a href="javascript:;" id="byTotalQso">By total QSOs</a> |
        <a href="javascript:;" id="byMult1">By mult 1</a><br />
    </div>
</div>

<script type="text/javascript">
    var totalqsosTitle = "QSOs";
    var mult1Title = "State-band mults";

    var measure;
    var lastUpdate;

    $(document).ready(function () {
        function refreshTable() {
            if (lastUpdate) {
                var msSince = Date.now() - lastUpdate;
                if (msSince > 10000) {
                    var warn = "No update for " + msSince + "ms";
                    console.log(warn);
                    $("#lastUpdate").html(warn);
                } else {
                    $("#lastUpdate").html("");
                }
            }

            $.getJSON("api/leaderboard/" + measure, function (data) {
                var node = $("#leaderboard > tbody");
                node.find("tr").remove();
                jQuery.each(data, function (i, val) {
                    var node = $("#leaderboard > tbody");

                    var h = "<tr><td>" + val.operator + "</td><td>" + val.count + "</td></tr>";

                    node.append(h);
                });

                lastUpdate = Date.now();
            });
        }

        // initial view
        measure = "TotalQsos";
        $('#measureTitle').html(totalqsosTitle);

        setInterval(refreshTable, 1000);
        refreshTable();
        
        $('#byTotalQso').on('click', function () { 
            measure = "TotalQsos";
            $('#measureTitle').html(totalqsosTitle);
            refreshTable();
        });

        $('#byMult1').on('click', function () {
            measure = "TotalIsMult1Contacts";
            $('#measureTitle').html(mult1Title);
            refreshTable();
        });

        /*number of qsos per op
            number of qsos per band per op
            number of ismultiplier1 per op

            gridsquares per op
            states per op*/
    });
</script>